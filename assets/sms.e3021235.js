import{n as R,_ as O,r as i,u as U,b as f,o as l,c,d as _,w as b,e as m,F as D,f as j,g as V,h as y,U as z,i as N,t as L,p as P,j as q,T as I,a as F}from"./index.b7b39bcc.js";import{u as T}from"./debounce.9f301d71.js";import{D as B}from"./dateFormat.340f37ba.js";import{b as H,S as G}from"./api.5dd931a9.js";const A=R({name:"SmsList",components:{},props:{type:Number},setup(e,{emit:n}){const d=i([]),t=i(""),u=i(!1),g=i(!1),a=i(1),r=i(20),o=i(!1);U();const p=()=>{let h=new Date().getTime(),w={data:{type:e.type,page_num:a.value,page_size:r.value,keyword:t.value},timestamp:h,sign:z.sisgn(h,z.sign())};N.post(H,w).then($=>{$.data.code===200&&($.data.data.length>=1?(u.value=!1,d.value.push(...$.data.data)):g.value=!0)})},C=()=>{p(),a.value++},s=(h,w)=>B.format(new Date(h),w),v=h=>B.getTime(h),S=()=>{g.value=!1,u.value=!0,a.value=1,d.value=[],p(),o.value=!1};let k=T("",500,h=>{d.value=[],t.value=h,S()});return{list:d,onLoad:C,loading:u,finished:g,onRefresh:S,refreshing:o,format:s,getTime:v,sendSms:h=>{let w=h.number.replace(/\s+/g,"");n("openSendContent",w,h)},keyword:k,keywords:t,useDebounced:T,getPageList:p,page_num:a,page_size:r}}}),M=e=>(P("data-v-af12148e"),e=e(),q(),e),J={id:"smsList"},K=["onClick"],Q={class:"smsContentInfo"},W={class:"smsContentext"},X={class:"smsContentOtherBtn"},Y={class:"smstime"},Z={key:0,class:"icon sim",style:{color:"#b2e7a7"},"aria-hidden":"true"},ee=M(()=>m("use",{"xlink:href":"#icon-dual-sim-1-line"},null,-1)),te=[ee],ne={key:1,class:"icon sim",style:{color:"#1296db"},"aria-hidden":"true"},se=M(()=>m("use",{"xlink:href":"#icon-dual-sim-2-line"},null,-1)),oe=[se],ae={key:2,class:"icon sim",style:{color:"#75bfdb"},"aria-hidden":"true"},ie=M(()=>m("use",{"xlink:href":"#icon-Sim-Card"},null,-1)),de=[ie],me={class:"smsContentSend"},le=["onClick"],re=M(()=>m("use",{"xlink:href":"#icon-duanxin"},null,-1)),ce=[re];function ue(e,n,d,t,u,g){const a=f("van-search"),r=f("van-image"),o=f("van-list"),p=f("van-empty"),C=f("van-pull-refresh");return l(),c("div",J,[_(a,{modelValue:e.keyword,"onUpdate:modelValue":n[0]||(n[0]=s=>e.keyword=s),placeholder:"\u641C\u7D22\u77ED\u4FE1",shape:"round","clear-trigger":"always"},null,8,["modelValue"]),_(C,{modelValue:e.refreshing,"onUpdate:modelValue":n[2]||(n[2]=s=>e.refreshing=s),onRefresh:e.onRefresh},{default:b(()=>[_(o,{loading:e.loading,"onUpdate:loading":n[1]||(n[1]=s=>e.loading=s),finished:e.finished,"finished-text":e.list.length>0?"\u6CA1\u6709\u66F4\u591A\u4E86":"",onLoad:e.onLoad},{default:b(()=>[m("ul",null,[(l(!0),c(D,null,j(e.list,(s,v)=>(l(),c("li",{class:"smsContentList",key:v},[m("div",{class:"smsContentImgInfo",onClick:S=>e.sendSms(s)},[_(r,{round:"",none:"",width:"2.5rem",height:"2.5rem",src:s.name==="\u672A\u77E5\u53F7\u7801"?"../static/image/sms1.png":`https://ui-avatars.com/api/?name=${s.name}&length=1&background=random&size=58&bold=true&color=ff0000`},null,8,["src"]),m("div",Q,[m("span",null,L(s.name==="\u672A\u77E5\u53F7\u7801"?s.number:s.name),1),m("p",W,L(s.content),1)])],8,K),m("div",X,[m("span",Y,L(e.format(s.date,"MM-dd HH:mm")),1),s.sim_id===0?(l(),c("svg",Z,te)):y("",!0),s.sim_id===1?(l(),c("svg",ne,oe)):y("",!0),s.sim_id===-1?(l(),c("svg",ae,de)):y("",!0),m("div",me,[(l(),c("svg",{class:"icon sms","aria-hidden":"true",onClick:S=>e.sendSms(s)},ce,8,le))])])]))),128))])]),_:1},8,["loading","finished","finished-text","onLoad"]),e.list.length<=0?(l(),V(p,{key:0,description:"\u6682\u65E0\u6570\u636E"})):y("",!0)]),_:1},8,["modelValue","onRefresh"])])}var pe=O(A,[["render",ue],["__scopeId","data-v-af12148e"]]);const he=R({name:"sendSmsContent",props:{number:String,smsContent:Object,key:Number},setup(e,{emit:n}){const d=i(""),t=i(""),u=i(1),g=i(!1),a=i([]),r=[{text:"SIM1",icon:"/static/image/0c98dc6c6b4e370d.png"},{text:"SIM2",icon:"/static/image/e63c357e3a7ae6b0.png"}];return e.number&&(d.value=e.number),e.smsContent&&a.value.push(e.smsContent),{phone_numbers:d,msg_content:t,formatter:v=>v.replace(/[^\d+(,\d\d\d)\d+$]/g,""),showPopover:g,actions:r,onSelect:v=>{I(v.text),u.value=v.text==="SIM1"?1:2},sendSms:()=>{if(d.value===""||d.value==="")return;let v=new Date().getTime(),S={data:{sim_slot:u.value,phone_numbers:d.value,msg_content:t.value},timestamp:v,sign:z.sisgn(v,z.sign())};N.post(G,S).then(k=>{if(k.data.code===200){I({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F",icon:"/static/image/7c682f7e147a30ce.png"});const x={content:t.value,type:2};a.value.push(x),setTimeout(()=>{n("close")},2500)}else I({message:"\u77ED\u4FE1\u53D1\u9001\u5931\u8D25",icon:"/static/image/5d2451c1941ae791.png"})})},sim_slot:u,sendList:a,close:()=>{a.value=[],a.value="",d.value=""}}}}),E=e=>(P("data-v-4cda5792"),e=e(),q(),e),ve={class:"sendSmsContent"},fe={class:"sendMain"},ge={key:0,id:"zm_6",style:{float:"left"}},_e={key:1,id:"zm_0",style:{float:"right"}},Ce=E(()=>m("svg",{class:"icon sim","aria-hidden":"true"},[m("use",{class:"con-SIMqia","xlink:href":"#icon-Simcard"})],-1)),Se=E(()=>m("use",{"xlink:href":"#icon-fasong"},null,-1)),ye=[Se];function be(e,n,d,t,u,g){const a=f("van-field"),r=f("van-popover");return l(),c("div",ve,[_(a,{class:"recipient",modelValue:e.phone_numbers,"onUpdate:modelValue":n[0]||(n[0]=o=>e.phone_numbers=o),"label-width":"3.5em",label:"\u6536\u4EF6\u4EBA",autofocus:!0,formatter:e.formatter,round:"",placeholder:"\u8BF7\u8F93\u5165\u6536\u4EF6\u4EBA\u624B\u673A\u53F7,\u5982\u6709\u591A\u4E2A\u53F7\u7801\u8BF7\u7528,\u5206\u5F00"},null,8,["modelValue","formatter"]),m("div",fe,[(l(!0),c(D,null,j(e.sendList,(o,p)=>(l(),c("div",{key:p},[o.type===1?(l(),c("div",ge,[m("p",null,L(o.content),1)])):y("",!0),o.type===2?(l(),c("div",_e,[m("p",null,L(o.content),1)])):y("",!0)]))),128))]),_(a,{class:"sendContent",modelValue:e.msg_content,"onUpdate:modelValue":n[3]||(n[3]=o=>e.msg_content=o),rows:"1","label-width":"2.5em",autosize:"",label:"\u5185\u5BB9",maxlength:"70",type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u53D1\u4FE1\u5185\u5BB9"},{button:b(()=>[_(r,{show:e.showPopover,"onUpdate:show":n[1]||(n[1]=o=>e.showPopover=o),actions:e.actions,onSelect:e.onSelect,placement:"top"},{reference:b(()=>[Ce]),_:1},8,["show","actions","onSelect"]),(l(),c("svg",{class:"icon send","aria-hidden":"true",onClick:n[2]||(n[2]=(...o)=>e.sendSms&&e.sendSms(...o))},ye))]),_:1},8,["modelValue"])])}var we=O(he,[["render",be],["__scopeId","data-v-4cda5792"]]);const Le={name:"SMS",components:{SmsList:pe,SendSmsContent:we},setup(){const e=i(1),n=i(1),d=i(""),t=i(0),u=i(0),g=i(),a=U(),r=i(!1),o=i({});F(()=>{p()}),window.localStorage.getItem("Toast")||(I({message:"\u70B9\u51FB\u4E0A\u65B9\u6309\u94AE\u53EF\u5207\u6362\u4FE1\u7BB1\u54E6",icon:"/static/image/smsmsg.png"}),window.localStorage.setItem("Toast","true"));const p=()=>{a.currentRoute.value.query.number&&(r.value=!0,d.value=a.currentRoute.value.query.number)};return{onClickType:()=>{e.value===1?e.value=2:e.value=1,n.value.getPageList(),t.value++},type:e,key:t,keys:u,typenum:n,onSendSms:()=>{r.value=!0},show:r,closed:()=>{g.value.close()},close:g,number:d,smsContent:o,showSend:p,showSendOpen:(x,h)=>{d.value=x,o.value=h,u.value++,r.value=!0},closeSendSms:()=>{r.value=!1}}}},ke={id:"Sms"};function xe(e,n,d,t,u,g){const a=f("van-icon"),r=f("van-nav-bar"),o=f("SmsList"),p=f("SendSmsContent"),C=f("van-popup");return l(),c("div",ke,[_(r,{title:"\u77ED\u4FE1","left-text":t.type===1?"\u6536\u4EF6\u7BB1":"\u53D1\u4EF6\u7BB1",onClickLeft:t.onClickType,onClickRight:t.onSendSms},{right:b(()=>[_(a,{name:"plus",size:"18"})]),_:1},8,["left-text","onClickLeft","onClickRight"]),(l(),V(o,{ref:"typenum",key:t.key,type:t.type,onOpenSendContent:t.showSendOpen},null,8,["type","onOpenSendContent"])),_(C,{show:t.show,"onUpdate:show":n[0]||(n[0]=s=>t.show=s),onClosed:t.closed,round:"",position:"bottom",style:{height:"80%"}},{default:b(()=>[(l(),V(p,{onClose:t.closeSendSms,number:t.number,smsContent:t.smsContent,ref:"close",key:t.keys},null,8,["onClose","number","smsContent"]))]),_:1},8,["show","onClosed"])])}var Ve=O(Le,[["render",xe],["__scopeId","data-v-1d190979"]]);export{Ve as default};
